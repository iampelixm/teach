/*! @name videojs-trimmer @version 0.1.2 @license UNLICENSED */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):t.videojsTrimmer=e(t.videojs)}(this,function(t){"use strict";function e(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var i=function(t,e){t.classList.add(e)},s=function(t,e){t.classList.remove(e)},n=function(t,e){return parseFloat(t.toFixed(e))},o=(t=t&&t.hasOwnProperty("default")?t.default:t).getComponent("Component"),r=t.extend(o,{constructor:function(t,e){o.call(this,t,e)},init_:function(){this.rs=this.player_.trimmer()},options_:{children:{ControlTimePanelLeft:{},ControlTimePanelRight:{}}},createEl:function(){return o.prototype.createEl.call(this,"div",{className:"vjs-controltimepanel-trimmer vjs-control"})},enable:function(t){t=void 0===t||t;this.rs.ctpl.el_.children[0].disabled=t?"":"disabled",this.rs.ctpl.el_.children[1].disabled=t?"":"disabled",this.rs.ctpl.el_.children[2].disabled=t?"":"disabled",this.rs.ctpr.el_.children[0].disabled=t?"":"disabled",this.rs.ctpr.el_.children[1].disabled=t?"":"disabled",this.rs.ctpr.el_.children[2].disabled=t?"":"disabled"}});t.registerComponent("ControlTimePanel",r);var l=t.getComponent("Component"),a=t.extend(l,{constructor:function(t,e){l.call(this,t,e),this.on("keyup",this.onKeyUp),this.on("keydown",this.onKeyDown)},init_:function(){this.rs=this.player_.trimmer(),this.timeOld={}},createEl:function(){return l.prototype.createEl.call(this,"div",{className:"vjs-controltimepanel-left-trimmer",innerHTML:'Start: <input type="text" id="controltimepanel" maxlength="2" value="00"/>:<input type="text" id="controltimepanel" maxlength="2" value="00"/>:<input type="text" id="controltimepanel" maxlength="2" value="00"/>'})},onKeyDown:function(t){this.timeOld[0]=this.el_.children[0].value,this.timeOld[1]=this.el_.children[1].value,this.timeOld[2]=this.el_.children[2].value},onKeyUp:function(t){this.rs._checkControlTime(0,this.el_.children,this.timeOld)}});t.registerComponent("ControlTimePanelLeft",a);var h=t.getComponent("Component"),c=t.extend(h,{constructor:function(t,e){h.call(this,t,e),this.on("keyup",this.onKeyUp),this.on("keydown",this.onKeyDown)},init_:function(){this.rs=this.player_.trimmer(),this.timeOld={}},createEl:function(){return h.prototype.createEl.call(this,"div",{className:"vjs-controltimepanel-right-trimmer",innerHTML:'End: <input type="text" id="controltimepanel" maxlength="2" value="00"/>:<input type="text" id="controltimepanel" maxlength="2" value="00"/>:<input type="text" id="controltimepanel" maxlength="2" value="00"/>'})},onKeyDown:function(t){this.timeOld[0]=this.el_.children[0].value,this.timeOld[1]=this.el_.children[1].value,this.timeOld[2]=this.el_.children[2].value},onKeyUp:function(t){this.rs._checkControlTime(1,this.el_.children,this.timeOld)}});t.registerComponent("ControlTimePanelRight",c);var p=t.getComponent("Component"),d=t.extend(p,{constructor:function(t,e){p.call(this,t,e)},init_:function(){this.rs=this.player_.trimmer()},options_:{children:{SeekRSBar:{}}},createEl:function(){return p.prototype.createEl.call(this,"div",{className:"vjs-timebar-trimmer",innerHTML:""})}});t.registerComponent("RSTimeBar",d);var u=t.getComponent("SeekBar"),m=t.getComponent("Component"),f=t.extend(u,{constructor:function(t,e){m.call(this,t,e),this.on("mousedown",this.onMouseDown),this.on("touchstart",this.onMouseDown)},init_:function(){this.rs=this.player_.trimmer()},options_:{children:{SelectionBar:{},SelectionBarLeft:{},SelectionBarRight:{},TimePanel:{}}},createEl:function(){return m.prototype.createEl.call(this,"div",{className:"vjs-trimmer-holder"})},onMouseDown:function(e){e.preventDefault(),this.rs.options.locked||(this.on(document,"mousemove",t.bind(this,this.onMouseMove)),this.on(document,"mouseup",t.bind(this,this.onMouseUp)),this.on(document,"touchmove",t.bind(this,this.onMouseMove)),this.on(document,"touchend",t.bind(this,this.onMouseUp)))},onMouseUp:function(e){this.off(document,"mousemove",t.bind(this,this.onMouseMove),!1),this.off(document,"mouseup",t.bind(this,this.onMouseUp),!1),this.off(document,"touchmove",t.bind(this,this.onMouseMove),!1),this.off(document,"touchend",t.bind(this,this.onMouseUp),!1)},onMouseMove:function(t){var e=this.calculateDistance(t);this.rs.left.pressed?this.setPosition(0,e):this.rs.right.pressed&&this.setPosition(1,e),this.rs.left.pressed?this.rs._triggerSliderChange("left"):this.rs.right.pressed&&this.rs._triggerSliderChange("right")},setPosition:function(t,e,i){i=void 0===i||i;if(t=t||0,this.rs.options.locked)return!1;if(isNaN(e))return!1;if(0!==t&&1!==t)return!1;var s,n,o,r=this.rs.left.el_,l=(this.rs.right.el_,this.rs[0===t?"left":"right"].el_),a=this.rs.tpr.el_,h=this.rs.tpl.el_,c=this.rs.bar,p=this.rs[0===t?"ctpl":"ctpr"].el_;if(0===t?c.updateLeft(e):c.updateRight(e)){l.style.left=100*e+"%",0===t?c.updateLeft(e):c.updateRight(e),this.rs[0===t?"start":"end"]=this.rs._seconds(e),0===t&&(r.style.zIndex=e>=.9?25:10);var d,u,m,f=(s=this.rs._seconds(e),n=Math.floor(s/60).toFixed(0),1===(o=(s%60).toFixed(0)).length&&(o="0"+o),n+":"+o),v=h.children[0].innerHTML.length;if(m=v<=4?this.player_.isFullScreen?3.25:6.5:v<=5?this.player_.isFullScreen?4:8:this.player_.isFullScreen?5:10,f.length<=4?(d=this.player_.isFullScreen?97:93,u=this.player_.isFullScreen?.1:.5):f.length<=5?(d=this.player_.isFullScreen?96:92,u=this.player_.isFullScreen?.1:.5):(d=this.player_.isFullScreen?95:91,u=this.player_.isFullScreen?.1:.5),0===t?(h.style.left=Math.max(u,Math.min(d,100*e-m/2))+"%",a.style.left.replace("%","")-h.style.left.replace("%","")<=m&&(h.style.left=Math.max(u,Math.min(d,a.style.left.replace("%","")-m))+"%"),h.children[0].innerHTML=f):(a.style.left=Math.max(u,Math.min(d,100*e-m/2))+"%",(a.style.left.replace("%","")||100)-h.style.left.replace("%","")<=m&&(a.style.left=Math.max(u,Math.min(d,h.style.left.replace("%","")-0+m))+"%"),a.children[0].innerHTML=f),i){var y,_,g,b=f.split(":");2==b.length?(y=0,_=b[0],g=b[1]):(y=b[0],_=b[1],g=b[2]),p.children[0].value=y,p.children[1].value=_,p.children[2].value=g}}return!0}});t.registerComponent("SeekRSBar",f);var v=t.getComponent("Component"),y=t.extend(v,{constructor:function(t,e){v.call(this,t,e),this.on("mouseup",this.onMouseUp),this.on("touchend",this.onMouseUp),this.fired=!1},options_:{children:{SelectionBarProgress:{}}},init_:function(){this.rs=this.player_.trimmer()},createEl:function(){return v.prototype.createEl.call(this,"div",{className:"vjs-selectionbar-trimmer"})},onMouseUp:function(){var t=this.rs.left.el_.style.left.replace("%",""),e=this.rs.right.el_.style.left.replace("%",""),i=this.player_.duration(),s=this.rs.updatePrecision,o=n(t*i/100,s),r=n(e*i/100,s);this.player_.currentTime(o),this.player_.play(),this.rs.bar.activatePlay(o,r)},updateLeft:function(t){var e=""!=this.rs.right.el_.style.left?this.rs.right.el_.style.left:100,i=parseFloat(e)/100,s=n(i-t,this.rs.updatePrecision);return t<=i+1e-5&&(this.rs.bar.el_.style.left=100*t+"%",this.rs.bar.el_.style.width=100*s+"%",!0)},updateRight:function(t){var e=""!=this.rs.left.el_.style.left?this.rs.left.el_.style.left:0,i=parseFloat(e)/100,s=n(t-i,this.rs.updatePrecision);return t+1e-5>=i&&(this.rs.bar.el_.style.width=100*s+"%",this.rs.bar.el_.style.left=100*(t-s)+"%",!0)},activatePlay:function(e,i){this.timeStart=e,this.timeEnd=i,this.suspendPlay(),this.player_.on("timeupdate",t.bind(this,this._processPlay))},suspendPlay:function(){this.fired=!1,this.player_.off("timeupdate",t.bind(this,this._processPlay))},_processPlay:function(){if(this.player_.currentTime()>=this.timeStart&&(this.timeEnd<0||this.player_.currentTime()<this.timeEnd)){if(this.fired)return;this.fired=!0}else{if(!this.fired)return;this.fired=!1,this.player_.pause(),this.player_.currentTime(this.timeEnd),this.suspendPlay()}},process_loop:function(){var t=this.player;if(console.log("porcess"),this.SelectionBarProgress.update(),t&&this.looping){var e=t.currentTime();(e<this.timeStart||this.timeEnd>0&&this.timeEnd<e)&&t.currentTime(this.timeStart)}}});t.registerComponent("SelectionBar",y);var _=t.getComponent("Component"),g=t.extend(_,{constructor:function(t,e){_.call(this,t,e)},init_:function(){this.rs=this.player_.trimmer()},createEl:function(){return _.prototype.createEl.call(this,"div",{className:"vjs-selectionbar-progress-trimmer vjs-play-progress"})},update:function(t,e){var i=""!=this.rs.right.el_.style.left?this.rs.right.el_.style.left:100,s=(e=parseFloat(i)/100,""!=this.rs.left.el_.style.left?this.rs.left.el_.style.left:0),n=(t=parseFloat(s)/100,(this.player_.currentTime()/this.player_.duration()-t)/(e-t));this.rs.barProgress.el_.style.width=100*n+"%"}});t.registerComponent("SelectionBarProgress",g);var b=t.getComponent("Component"),T=t.extend(b,{constructor:function(t,e){b.call(this,t,e),this.on("mousedown",this.onMouseDown),this.on("touchstart",this.onMouseDown),this.pressed=!1},init_:function(){this.rs=this.player_.trimmer()},createEl:function(){return b.prototype.createEl.call(this,"div",{className:"vjs-trimmer-handle vjs-selectionbar-left-trimmer",innerHTML:'<div class="vjs-selectionbar-arrow-trimmer"></div><div class="vjs-selectionbar-line-trimmer"></div>'})},onMouseDown:function(e){e.preventDefault(),this.rs.options.locked||(this.pressed=!0,this.on(document,"mouseup",t.bind(this,this.onMouseUp)),this.on(document,"touchend",t.bind(this,this.onMouseUp)),i(this.el_,"active"))},onMouseUp:function(e){this.off(document,"mouseup",t.bind(this,this.onMouseUp),!1),this.off(document,"touchend",t.bind(this,this.onMouseUp),!1),s(this.el_,"active"),this.rs.options.locked||(this.pressed=!1)}});t.registerComponent("SelectionBarLeft",T);var C=t.getComponent("Component"),M=t.extend(C,{constructor:function(t,e){C.call(this,t,e),this.on("mousedown",this.onMouseDown),this.on("touchstart",this.onMouseDown),this.pressed=!1},init_:function(){this.rs=this.player_.trimmer()},createEl:function(){return C.prototype.createEl.call(this,"div",{className:"vjs-trimmer-handle vjs-selectionbar-right-trimmer",innerHTML:'<div class="vjs-selectionbar-arrow-trimmer"></div><div class="vjs-selectionbar-line-trimmer"></div>'})},onMouseDown:function(e){e.preventDefault(),this.rs.options.locked||(this.pressed=!0,this.on(document,"mouseup",t.bind(this,this.onMouseUp)),this.on(document,"touchend",t.bind(this,this.onMouseUp)),i(this.el_,"active"))},onMouseUp:function(e){this.off(document,"mouseup",t.bind(this,this.onMouseUp),!1),this.off(document,"touchend",t.bind(this,this.onMouseUp),!1),s(this.el_,"active"),this.rs.options.locked||(this.pressed=!1)}});t.registerComponent("SelectionBarRight",M);var P=t.getComponent("Component"),x=t.extend(P,{constructor:function(t,e){P.call(this,t,e)},init_:function(){this.rs=this.player_.trimmer()},options_:{children:{TimePanelLeft:{},TimePanelRight:{}}},createEl:function(){return P.prototype.createEl.call(this,"div",{className:"vjs-timepanel-trimmer"})}});t.registerComponent("TimePanel",x);var S=t.getComponent("Component"),w=t.extend(S,{constructor:function(t,e){S.call(this,t,e)},init_:function(){this.rs=this.player_.trimmer()},createEl:function(){return S.prototype.createEl.call(this,"div",{className:"vjs-timepanel-left-trimmer",innerHTML:'<span class="vjs-time-text">00:00</span>'})}});t.registerComponent("TimePanelLeft",w);var k=t.getComponent("Component"),E=t.extend(k,{constructor:function(t,e){k.call(this,t,e)},init_:function(){this.rs=this.player_.trimmer()},createEl:function(){return k.prototype.createEl.call(this,"div",{className:"vjs-timepanel-right-trimmer",innerHTML:'<span class="vjs-time-text">00:00</span>'})}});t.registerComponent("TimePanelRight",E);var L={},j=function(o){var r,l;function a(i,s){var n;(n=o.call(this,i)||this).options=t.mergeOptions(L,s),n.options.hasOwnProperty("locked")||(n.options.locked=!1),n.options.hasOwnProperty("hidden")||(n.options.hidden=!0),n.options.hasOwnProperty("panel")||(n.options.panel=!0),n.options.hasOwnProperty("controlTime")||(n.options.controlTime=!0),n.components={},n.player.ready(function(){n.player.addClass("vjs-trimmer")}),n.init();var r=function(){var t=e(e(n));for(var s in t.components)t.components[s].init_();n.player.on("timeupdate",function(){n.barProgress.update()}),t.options.hidden&&t.hide(),t.options.locked&&t.lock(),0==t.options.panel&&t.hidePanel(),0==t.options.controlTime&&t.hidecontrolTime(),t._reset(),i.trigger("loadedRangeSlider")};return"Youtube"==i.techName?(i.one("error",function(t){switch(i.error){case 2:alert("The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.");case 5:alert("The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.");case 100:alert("The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.");break;case 101:case 150:alert("The owner of the requested video does not allow it to be played in embedded players.");break;default:alert("Unknown Error")}}),i.on("firstplay",r)):i.one("playing",r),n}l=o,(r=a).prototype=Object.create(l.prototype),r.prototype.constructor=r,r.__proto__=l;var h=a.prototype;return h.init=function(){var t=this.player||{};this.updatePrecision=3,this.start=0,this.end=0;var e=t.controlBar,i=e.progressControl.seekBar.addChild("RSTimeBar"),s=e.addChild("ControlTimePanel");this.components.RSTimeBar=i,this.components.ControlTimePanel=s,this.rstb=this.components.RSTimeBar,this.box=this.components.SeekRSBar=this.rstb.SeekRSBar,this.bar=this.components.SelectionBar=this.box.SelectionBar,this.barProgress=this.components.SelectionBarProgress=this.bar.SelectionBarProgress,this.left=this.components.SelectionBarLeft=this.box.SelectionBarLeft,this.right=this.components.SelectionBarRight=this.box.SelectionBarRight,this.tp=this.components.TimePanel=this.box.TimePanel,this.tpl=this.components.TimePanelLeft=this.tp.TimePanelLeft,this.tpr=this.components.TimePanelRight=this.tp.TimePanelRight,this.ctp=this.components.ControlTimePanel,this.ctpl=this.components.ControlTimePanelLeft=this.ctp.ControlTimePanelLeft,this.ctpr=this.components.ControlTimePanelRight=this.ctp.ControlTimePanelRight},h.lock=function(){this.options.locked=!0,this.ctp.enable(!1),void 0!==this.box&&i(this.box.el_,"locked")},h.unlock=function(){this.options.locked=!1,this.ctp.enable(),void 0!==this.box&&s(this.box.el_,"locked")},h.show=function(){this.options.hidden=!1,void 0!==this.rstb&&(this.rstb.show(),this.options.controlTime&&this.showcontrolTime())},h.hide=function(){this.options.hidden=!0,void 0!==this.rstb&&(this.rstb.hide(),this.ctp.hide())},h.showPanel=function(){this.options.panel=!0,void 0!==this.tp&&s(this.tp.el_,"disable")},h.hidePanel=function(){this.options.panel=!1,void 0!==this.tp&&i(this.tp.el_,"disable")},h.showcontrolTime=function(){this.options.controlTime=!0,void 0!==this.ctp&&this.ctp.show()},h.hidecontrolTime=function(){this.options.controlTime=!1,void 0!==this.ctp&&this.ctp.hide()},h.setValue=function(t,e,i){i=void 0===i||i;var s=this._percent(e),n=0===t||1===t;!this.locked&&n&&this.box.setPosition(t,s,i)},h.setValues=function(t,e,i){i=void 0===i||i;this._reset(),this._setValuesLocked(t,e,i)},h.getValues=function(){return{start:this.start||this._getArrowValue(0),end:this.end||this._getArrowValue(1)}},h.playBetween=function(t,e,i,s){s=void 0===s||s,this.player.currentTime(i),this.player.play(),s?(this.show(),this._reset()):this.hide(),this._setValuesLocked(t,e),this.bar.activatePlay(t,e)},h.loop=function(e,i,s,n){var o=this.player;o&&(o.on("pause",t.bind(this,function(){this.looping=!1})),(n=void 0===n||n)?(this.show(),this._reset()):this.hide(),this._setValuesLocked(e,i),this.timeStart=e,this.timeEnd=i,this.looping=!0,this.player.currentTime(s),this.player.play(),this.player.on("timeupdate",t.bind(this,this.bar.process_loop)))},h._getArrowValue=function(t){var e=t||0,i=this.player.duration();i=void 0===i?0:i;var s=this[0===e?"left":"right"].el_.style.left.replace("%","");return""==s&&(s=0===e?0:100),n(this._seconds(s/100),this.updatePrecision-1)},h._percent=function(t){var e=this.player.duration();return isNaN(e)?0:Math.min(1,Math.max(0,t/e))},h._seconds=function(t){var e=this.player.duration();return isNaN(e)?0:Math.min(e,Math.max(0,t*e))},h._reset=function(){var t=this.player.duration();this.tpl.el_.style.left="0%",this.tpr.el_.style.left="100%",this._setValuesLocked(0,t)},h._setValuesLocked=function(t,e,i){var s=void 0!==i;i=void 0===i||i;this.options.locked?(this.unlock(),this.setValue(0,t,i),this.setValue(1,e,i),this.lock()):(this.setValue(0,t,i),this.setValue(1,e,i)),s&&this._triggerSliderChange()},h._checkControlTime=function(e,i,s){var n,o,r,l=i[0],a=i[1],h=i[2],c=l.value,p=a.value,d=h.value;if(e=e||0,c!=s[0])n=l,o=c,r=s[0];else if(p!=s[1])n=a,o=p,r=s[1];else{if(d==s[2])return!1;n=h,o=d,r=s[2]}var u,m=this.player.duration()||0;if((!/^\d+$/.test(o)||o>60)&&(o=""==o?"":r),c=""==c?0:c,p=""==p?0:p,d=""==d?0:d,(u=t.TextTrack.prototype.parseCueTime(c+":"+p+":"+d))>m?(n.value=r,n.style.border="1px solid red"):(n.value=o,l.style.border=a.style.border=h.style.border="1px solid transparent",this.setValue(e,u,!1),this._triggerSliderChange()),1===e){var f=this.ctpl.el_.children;u<t.TextTrack.prototype.parseCueTime(f[0].value+":"+f[1].value+":"+f[2].value)&&(n.style.border="1px solid red")}else{var v=this.ctpr.el_.children;u>t.TextTrack.prototype.parseCueTime(v[0].value+":"+v[1].value+":"+v[2].value)&&(n.style.border="1px solid red")}},h._triggerSliderChange=function(t){this.player.trigger({type:"sliderchange",side:t})},a}(t.getPlugin("plugin"));return j.defaultState={},j.VERSION="0.1.2",t.registerPlugin("trimmer",j),j});
